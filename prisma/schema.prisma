generator client {
  provider     = "prisma-client"
  output       = "../src/generated"
  moduleFormat = "esm"
}

datasource db {
  provider = "postgresql"
}

enum JobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  DEAD
}

enum JobExecutionStatus {
  STARTED
  SUCCESS
  FAILED
}

model JobAudit {
  id         String         @id @default(uuid())
  queueName  String
  jobName    String
  payload    Json
  status     JobStatus
  attempts   Int
  executions JobExecution[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model JobExecution {
  id             String             @id @default(uuid())
  jobAuditId     String
  attempt        Int
  status         JobExecutionStatus @default(STARTED)
  errorSanitized String?
  jobAudit       JobAudit           @relation(fields: [jobAuditId], references: [id])

  startedAt  DateTime  @default(now())
  finishedAt DateTime?

  @@index([jobAuditId])
}
